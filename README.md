# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `HeartBeatRecommender`

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
python -m venv heartrec
. heartrec/bin/activate

pip install https://github.com/CPJKU/beat_this/archive/main.zip
pip install dtaidistance
```

## üìò –û–ø–∏—Å–∞–Ω–∏–µ

–ö–ª–∞—Å—Å `HeartBeatRecommender` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–µ—Å–µ–Ω –ø–æ —Ä–∏—Ç–º—É —Å–µ—Ä–¥—Ü–µ–±–∏–µ–Ω–∏—è. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–∏—Ç–º–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–µ—Ç–æ–¥–æ–≤ –∫—Ä–æ—Å—Å-–∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –∏ DTW (Dynamic Time Warping).

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```python
{"–Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏": [–≤—Ä–µ–º—è_–¥–∞—É–Ω–±–∏—Ç–æ–≤]}
```

**–ü—Ä–∏–º–µ—Ä:**
```python
{
  "Rock": [1.0, 2.0, 3.0, 4.0],
  "Waltz": [1.0, 2.5, 4.0, 5.5],
  "Jazz": [1.0, 1.8, 3.2, 4.0]
}
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Å–µ–Ω

#### `add_song(song_name: str, downbeats: List[float])`

–î–æ–±–∞–≤–ª—è–µ—Ç –ø–µ—Å–Ω—é –≤—Ä—É—á–Ω—É—é –ø–æ —Å–ø–∏—Å–∫—É –¥–∞—É–Ω–±–∏—Ç–æ–≤.

```python
manager.add_song("Rock", [1.0, 2.0, 3.0, 4.0])
```

### 3. –ü–æ–∏—Å–∫ –ª—É—á—à–∏—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

#### `find_best_matches(heartbeat_downbeats: List[float], top_n: int = 3)`

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –∫—Ä–æ—Å—Å-–∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏.

```python
heartbeat = [1.0, 2.1, 3.2, 4.3]
matches = manager.find_best_matches(heartbeat)
print(matches)  # [("Rock", 0.92), ("Jazz", 0.85), ("Waltz", 0.78)]
```

#### `find_best_matches_with_dynamic_time_warping(heartbeat_downbeats, top_n=3)`

–¢–æ—á–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º DTW.

```python
matches_dtw = manager.find_best_matches_with_dynamic_time_warping(heartbeat)
print(matches_dtw)  # [("Rock", 0.95), ("Jazz", 0.88), ("Waltz", 0.80)]
```

### 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

#### `save_to_json(file_path: str)`

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏—é –ø–µ—Å–µ–Ω –≤ —Ñ–∞–π–ª.

```python
manager.save_to_json("songs.json")
```

#### `load_from_json(file_path: str)`

–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏—é –ø–µ—Å–µ–Ω –∏–∑ JSON-—Ñ–∞–π–ª–∞.

```python
manager.load_from_json("songs.json")
```

## üí° –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
manager = HeartBeatRecommender()
manager.add_song("Rock", [1.0, 2.0, 3.0, 4.0])
manager.add_song("Jazz", [1.0, 1.8, 3.2, 4.0])

heartbeat = [1.0, 2.1, 3.2, 4.3]
matches = manager.find_best_matches(heartbeat)
print("–õ—É—á—à–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è:", matches)
```

## üìä –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã

### 1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è

I_norm = I / Œº(I), –≥–¥–µ Œº(I) = (t‚Çô - t‚ÇÅ)/(n - 1)

### 2. –ö—Ä–æ—Å—Å-–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è

œÅ = Œ£[(x_i - Œº_x)(y_i - Œº_y)] / (œÉ_x œÉ_y), –æ—Ü–µ–Ω–∫–∞: score = (œÅ + 1)/2

### 3. Dynamic Time Warping

D(i,j) = d(i,j) + min(D(i-1,j), D(i-1,j-1), D(i,j-1))  
score = 1 / (1 + DTW_dist)

## üìÅ –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–∞

```json
{
  "songs": {
    "Song 1": [1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5],
    "Song 2": [1.0, 1.3, 1.6, 2.0, 2.3, 2.6, 3.0, 3.3],
    "Song 3": [1.0, 1.8, 2.6, 3.4, 4.2, 5.0]
  }
}
```

## üß† –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

- –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–∫–µ—Ä—ã  
- –ë–∏–æ–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞  

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–ª—É—á—à–µ–Ω–∏—è

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ `librosa`  
- –û–±—É—á–∞–µ–º—ã–µ –º–æ–¥–µ–ª–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è (ML)  
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—É–¥–∏–æ-–ø–æ—Ç–æ–∫–æ–≤ –∏ –æ–Ω–ª–∞–π–Ω-–æ–±—Ä–∞–±–æ—Ç–∫–∏
